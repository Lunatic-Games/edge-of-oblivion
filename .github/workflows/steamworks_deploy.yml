name: Build and Deploy to Steam

on:
  workflow_dispatch:
    inputs:
      buildDescription:
        description: Build Description
        required: false
        default: 'A generic build'
      linux:
        description: Build Linux
        type: boolean
        required: false
        default: true
      windows:
        description: Build Windows
        type: boolean
        required: false
        default: true

jobs:
  build:
    name: Build game
    uses: ./.github/workflows/plug_godot_build.yml
    with:
      debug: false
      godot_version: "4.1"
      export_name: dist-${{ github.event.repository.name }}-${{ github.run_number }}
      windows: ${{ inputs.windows }}
      windows_preset: Windows Desktop
      linux: ${{ inputs.linux }}
      linux_preset: Linux/X11
      project_path: '.'
      export_presets_path: '.'
      artifact_retention_days: 1
          
  deploy:
    name: Deploy to Steam
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Download windows artifacts
        if: ${{ inputs.windows }}
        uses: actions/download-artifact@v3.0.2
        with:
          name: windows-dist-${{ github.event.repository.name }}-${{ github.run_number }}
          path: build/windows
          
      - name: Download linux artifacts
        if: ${{ inputs.linux }}
        uses: actions/download-artifact@v3.0.2
        with:
          name: linux-dist-${{ github.event.repository.name }}-${{ github.run_number }}
          path: build/linux
          
      - name: Test download
        run: find . -maxdepth 3
          
 #     - uses: game-ci/steam-deploy@v3
 #       with:
 #         username: ${{ secrets.STEAM_USERNAME }}          
 #         configVdf: ${{ secrets.STEAM_CONFIG_VDF}}          
 #         appId: 1354590
 #         buildDescription: ${{ github.event.inputs.buildDescription }}
 #         rootPath: build
 #         depot1Path: windows
